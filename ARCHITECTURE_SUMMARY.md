# 🏛️ Arquitectura Completa del Sistema de Contenido Dinámico\n\n**Resumen ejecutivo de toda la arquitectura**\n\n**Fecha:** 2025-10-29  \n**Fase:** Diseño completo\n\n---\n\n## 📂 Estructura de Archivos\n\n```\nnavegador/\n├── types/\n│   ├── content-schema.ts           ← Tipos principales (cartas, eventos, tiendas, etc)\n│   └── event-chains.ts             ← Tipos para cadenas narrativas\n│\n├── services/\n│   ├── contentEngine.ts            ← Motor que carga y procesa JSON\n│   ├── eventChainManager.ts        ← Gestor de cadenas narrativas\n│   └── eventManager.ts             ← (Existente, será actualizado)\n│\n├── editor/                         ← Herramienta web para crear contenido\n│   ├── index.html\n│   ├── styles.css\n│   ├── js/\n│   │   ├── app.js                  ← Store global, lógica principal\n│   │   ├── editor-events.ts        ← CRUD de eventos\n│   │   ├── editor-cards.ts         ← CRUD de cartas\n│   │   ├── editor-chains.ts        ← CRUD de cadenas\n│   │   ├── editor-shops.ts         ← CRUD de tiendas\n│   │   ├── editor-dialogues.ts     ← CRUD de diálogos\n│   │   ├── media-manager.ts        ← Upload de imágenes/videos\n│   │   └── utils.js               ← Helpers\n│   └── examples/                   ← Ejemplos JSON\n│\n├── public/\n│   └── content/\n│       ├── content.json            ← Archivo principal (todo integrado)\n│       ├── media/                  ← Imágenes, videos\n│       │   ├── events/\n│       │   ├── cards/\n│       │   ├── ships/\n│       │   └── characters/\n│       └── examples/               ← JSONs de ejemplo\n│\n└── DOCUMENTATION/\n    ├── CONTENT_SYSTEM_PLAN.md      ← Plan general\n    └── EVENT_CHAINS_DESIGN.md      ← Cadenas narrativas\n```\n\n---\n\n## 🎯 Flujo Completo de Contenido\n\n### **1. CREACIÓN (Editor Web)**\n\n```\nContenedor Principal (editor/index.html)\n│\n├─ Tabs: [Eventos] [Cartas] [Naves] [Tiendas] [Diálogos] [Cadenas]\n│\n├─ Tab EVENTOS\n│  ├─ Lista (búsqueda, filtro)\n│  ├─ Editor Visual\n│  │  ├─ Título, Tipo, Imagen, Video\n│  │  ├─ Narrativa (intro + prompt)\n│  │  ├─ Opciones (CRUD)\n│  │  │  ├─ Texto\n│  │  │  ├─ Requisitos (crew, credits, flags)\n│  │  │  └─ Consecuencias (rolls probabilísticas)\n│  │  └─ Preview en tiempo real\n│  └─ Guardar / Exportar JSON\n│\n├─ Tab CARTAS\n│  ├─ Lista (filtrar por tipo, facción, rareza)\n│  ├─ Editor Visual\n│  │  ├─ Stats básicos\n│  │  ├─ Sinergias\n│  │  ├─ Afinidades\n│  │  ├─ Efectos de combate\n│  │  └─ Imagen\n│  └─ Guardar\n│\n├─ Tab NAVES\n│  ├─ Editor de estadísticas especiales\n│  ├─ Habilidades especiales\n│  └─ Guardar\n│\n├─ Tab TIENDAS\n│  ├─ Configuración de traits\n│  ├─ Inventario (drag & drop)\n│  ├─ Servicios disponibles\n│  ├─ Diálogo de bienvenida\n│  └─ Guardar\n│\n├─ Tab DIÁLOGOS\n│  ├─ Secuencias de diálogo entre personajes\n│  ├─ Mensajes visuales\n│  ├─ Editor con timeline\n│  └─ Guardar\n│\n└─ Tab CADENAS\n   ├─ Vista de grafo visual (nodos y conexiones)\n   ├─ Editor de nodos\n   │  ├─ Evento asociado\n   │  ├─ Condiciones\n   │  └─ Transiciones\n   ├─ Simulador de caminos\n   └─ Guardar\n```\n\n### **2. ALMACENAMIENTO (JSON)**\n\n```json\n{\n  \"version\": \"1.0.0\",\n  \"metadata\": {...},\n  \n  \"cards\": [...],           // Todas las cartas\n  \"ships\": [...],           // Naves disponibles\n  \"shops\": [...],           // Tiendas y vendedores\n  \n  \"encounters\": [...],      // Eventos de encuentro\n  \"hazards\": [...],         // Eventos de peligro\n  \"eventChains\": [...],     // Cadenas narrativas\n  \n  \"dialogues\": [...],       // Diálogos entre personajes\n  \"messages\": [...],        // Mensajes del sistema\n  \n  \"synergies\": [...],       // Sinergias de cartas\n  \"achievements\": [...],    // Logros\n  \n  \"flags\": {...},           // Definiciones de banderas\n  \"combatEffects\": {...}    // Definiciones de efectos\n}\n```\n\n### **3. CARGA (ContentEngine)**\n\n```\nAp inicia\n  │\n  └─ await contentEngine.load('content/content.json')\n     │\n     ├─ Fetch del JSON\n     ├─ Validar contra schema\n     ├─ Parse y cachear\n     └─ Iniciar managers\n        ├─ EventManager (eventos simples)\n        ├─ EventChainManager (cadenas)\n        ├─ ShopManager (tiendas)\n        └─ DialogueManager (diálogos)\n  │\n  └─ Listo para usar\n```\n\n### **4. EJECUCIÓN (En Juego)**\n\n```\nJugador llega a nodo ENCOUNTER\n  │\n  ├─ ¿Hay cadena activa?\n  │  └─ Sí → EventChainManager.getCurrentEvent()\n  │\n  ├─ ¿Puede iniciarse nueva cadena?\n  │  └─ Sí → EventChainManager.startChain()\n  │\n  └─ Evento aleatorio normal\n     └─ EventManager.getRandomEncounter()\n  │\n  └─ Mostrar EventCard con:\n     ├─ Narrativa\n     ├─ Imagen/Video\n     ├─ Opciones\n     └─ Preview de consecuencias\n  │\n  └─ Jugador selecciona opción\n     │\n     ├─ ProcessConsequence()\n     │  ├─ Calcular resultado (probabilidad)\n     │  ├─ Aplicar cambios de estado\n     │  ├─ Activar banderas\n     │  ├─ Cambiar afinidad\n     │  └─ Mostrar diálogos\n     │\n     └─ ¿Es parte de cadena?\n        └─ EventChainManager.processChainChoice()\n           ├─ Verificar condiciones siguientes\n           ├─ Avanzar nodo\n           └─ Marcar próximo evento\n```\n\n---\n\n## 🎮 Tipos de Contenido Soportados\n\n### **1. Eventos Simples**\n- Encuentro de exploración\n- Peligro galáctico\n- Evento de combate\n- Evento de negociación\n\n### **2. Cadenas Narrativas**\n- \"La Base Abandonada\" (exploración → combate)\n- \"El Misterio de Vex\" (narrativo de 4 capítulos)\n- \"Motín a Bordo\" (interno con condiciones)\n- Cualquier combinación de eventos interconectados\n\n### **3. Cartas de Juego**\n- Cartas de Tripulación (con afinidades)\n- Cartas de Ataque\n- Cartas de Habilidad\n- Cartas de Equipo\n- Cartas de Nave (especiales)\n\n### **4. Tiendas**\n- Diferentes traits (Generoso, Avaro, etc)\n- Inventarios únicos\n- Servicios específicos\n- Diálogos personalizados\n\n### **5. Diálogos**\n- Entre tripulantes\n- Con NPCs\n- Cinemáticas\n- Con música y efectos visuales\n\n### **6. Sinergias**\n- Por facción\n- Multi-cartas\n- Con efectos visuales\n- Activables/desactivables\n\n---\n\n## 🔧 Características del Motor\n\n### **ContentEngine**\n```typescript\nclass ContentEngine {\n  load(path: string)                    // Cargar JSON\n  validate(schema: any)                 // Validar estructura\n  getEvent(type, chainId?)              // Obtener evento\n  getCard(id)                           // Obtener carta\n  getShop(id)                           // Obtener tienda\n  getDialogue(id)                       // Obtener diálogo\n  getSynergies(cards)                   // Calcular sinergias\n  applyConsequence(option, state)       // Aplicar consecuencia\n}\n```\n\n### **EventChainManager**\n```typescript\nclass EventChainManager {\n  startChain(chainId, state)            // Iniciar cadena\n  processChainChoice(chainId, nodeId)   // Avanzar en cadena\n  completeChain(chainId, state)         // Completar cadena\n  abandonChain(chainId, state)          // Abandonar cadena\n  checkForTriggered(state)              // Ver si hay cadenas activables\n}\n```\n\n---\n\n## 📊 Sistema de Validación\n\n```\nEditor JS → Validar Localmente\n           ├─ IDs únicos\n           ├─ Referencias válidas\n           ├─ Campos requeridos\n           └─ Tipos correctos\n           │\n           └─ OK → Guardar JSON\n              │\n              └─ Motor en Juego → Validar al cargar\n                 ├─ Esquema completo\n                 ├─ Referencias circulares\n                 └─ Integridad\n```\n\n---\n\n## 🎯 Ventajas de Esta Arquitectura\n\n✅ **Separación Total:** Contenido ≠ Código  \n✅ **Editabilidad:** Cambiar contenido sin compilar  \n✅ **Modularidad:** Cada tipo de contenido es independiente  \n✅ **Escalabilidad:** Agregar 1000 eventos es trivial  \n✅ **Colaborativo:** Múltiples personas pueden editar JSON  \n✅ **Versionable:** Git controla todo el contenido  \n✅ **Testeable:** Validar JSON antes de usar  \n✅ **Extensible:** Nuevos tipos de contenido fácilmente  \n✅ **Portable:** JSON funciona en cualquier lado  \n✅ **Performante:** Caché y lazy-loading de contenido  \n\n---\n\n## 🚀 Roadmap de Implementación\n\n### **Sprint 1: Esquema (1-2 días)**\n- ✅ types/content-schema.ts\n- ✅ types/event-chains.ts\n- ✅ Documentación\n\n### **Sprint 2: Editor Base (3-4 días)**\n- [ ] HTML/CSS básico\n- [ ] CRUD para eventos\n- [ ] Preview en tiempo real\n- [ ] Export/Import JSON\n\n### **Sprint 3: Expansión Editor (2-3 días)**\n- [ ] CRUD para cartas\n- [ ] CRUD para tiendas\n- [ ] CRUD para diálogos\n- [ ] Editor de cadenas (visual)\n\n### **Sprint 4: Motor (2-3 días)**\n- [ ] ContentEngine\n- [ ] EventChainManager\n- [ ] Validador de esquemas\n- [ ] Cache y optimización\n\n### **Sprint 5: Integración (2-3 días)**\n- [ ] Reemplazar constants.ts\n- [ ] Actualizar componentes React\n- [ ] Testing\n- [ ] Optimización de carga\n\n---\n\n## 📝 Próximos Pasos\n\n1. **Empezar con Editor de Eventos**\n   - Prototipo simple con HTML/JS\n   - CRUD funcional\n   - Export a JSON\n\n2. **Crear ejemplos JSON**\n   - 3-4 eventos de ejemplo\n   - 5-10 cartas de ejemplo\n   - 1-2 tiendas de ejemplo\n   - 1 cadena narrativa completa\n\n3. **Implementar ContentEngine**\n   - Cargar JSON\n   - Validación básica\n   - APIs de acceso\n\n4. **Integrar en juego**\n   - Reemplazar hardcoded data\n   - Probar con juego en vivo\n   - Optimizar rendimiento\n\n---\n\n## 🔗 Referencias\n\n- [Content System Plan](CONTENT_SYSTEM_PLAN.md)\n- [Event Chains Design](EVENT_CHAINS_DESIGN.md)\n- [Types: content-schema.ts](types/content-schema.ts)\n- [Types: event-chains.ts](types/event-chains.ts)\n\n---\n\n**Esta arquitectura permite crear un juego completamente editable sin tocar código.**\n"}