# ğŸ›ï¸ Arquitectura Completa del Sistema de Contenido DinÃ¡mico\n\n**Resumen ejecutivo de toda la arquitectura**\n\n**Fecha:** 2025-10-29  \n**Fase:** DiseÃ±o completo\n\n---\n\n## ğŸ“‚ Estructura de Archivos\n\n```\nnavegador/\nâ”œâ”€â”€ types/\nâ”‚   â”œâ”€â”€ content-schema.ts           â† Tipos principales (cartas, eventos, tiendas, etc)\nâ”‚   â””â”€â”€ event-chains.ts             â† Tipos para cadenas narrativas\nâ”‚\nâ”œâ”€â”€ services/\nâ”‚   â”œâ”€â”€ contentEngine.ts            â† Motor que carga y procesa JSON\nâ”‚   â”œâ”€â”€ eventChainManager.ts        â† Gestor de cadenas narrativas\nâ”‚   â””â”€â”€ eventManager.ts             â† (Existente, serÃ¡ actualizado)\nâ”‚\nâ”œâ”€â”€ editor/                         â† Herramienta web para crear contenido\nâ”‚   â”œâ”€â”€ index.html\nâ”‚   â”œâ”€â”€ styles.css\nâ”‚   â”œâ”€â”€ js/\nâ”‚   â”‚   â”œâ”€â”€ app.js                  â† Store global, lÃ³gica principal\nâ”‚   â”‚   â”œâ”€â”€ editor-events.ts        â† CRUD de eventos\nâ”‚   â”‚   â”œâ”€â”€ editor-cards.ts         â† CRUD de cartas\nâ”‚   â”‚   â”œâ”€â”€ editor-chains.ts        â† CRUD de cadenas\nâ”‚   â”‚   â”œâ”€â”€ editor-shops.ts         â† CRUD de tiendas\nâ”‚   â”‚   â”œâ”€â”€ editor-dialogues.ts     â† CRUD de diÃ¡logos\nâ”‚   â”‚   â”œâ”€â”€ media-manager.ts        â† Upload de imÃ¡genes/videos\nâ”‚   â”‚   â””â”€â”€ utils.js               â† Helpers\nâ”‚   â””â”€â”€ examples/                   â† Ejemplos JSON\nâ”‚\nâ”œâ”€â”€ public/\nâ”‚   â””â”€â”€ content/\nâ”‚       â”œâ”€â”€ content.json            â† Archivo principal (todo integrado)\nâ”‚       â”œâ”€â”€ media/                  â† ImÃ¡genes, videos\nâ”‚       â”‚   â”œâ”€â”€ events/\nâ”‚       â”‚   â”œâ”€â”€ cards/\nâ”‚       â”‚   â”œâ”€â”€ ships/\nâ”‚       â”‚   â””â”€â”€ characters/\nâ”‚       â””â”€â”€ examples/               â† JSONs de ejemplo\nâ”‚\nâ””â”€â”€ DOCUMENTATION/\n    â”œâ”€â”€ CONTENT_SYSTEM_PLAN.md      â† Plan general\n    â””â”€â”€ EVENT_CHAINS_DESIGN.md      â† Cadenas narrativas\n```\n\n---\n\n## ğŸ¯ Flujo Completo de Contenido\n\n### **1. CREACIÃ“N (Editor Web)**\n\n```\nContenedor Principal (editor/index.html)\nâ”‚\nâ”œâ”€ Tabs: [Eventos] [Cartas] [Naves] [Tiendas] [DiÃ¡logos] [Cadenas]\nâ”‚\nâ”œâ”€ Tab EVENTOS\nâ”‚  â”œâ”€ Lista (bÃºsqueda, filtro)\nâ”‚  â”œâ”€ Editor Visual\nâ”‚  â”‚  â”œâ”€ TÃ­tulo, Tipo, Imagen, Video\nâ”‚  â”‚  â”œâ”€ Narrativa (intro + prompt)\nâ”‚  â”‚  â”œâ”€ Opciones (CRUD)\nâ”‚  â”‚  â”‚  â”œâ”€ Texto\nâ”‚  â”‚  â”‚  â”œâ”€ Requisitos (crew, credits, flags)\nâ”‚  â”‚  â”‚  â””â”€ Consecuencias (rolls probabilÃ­sticas)\nâ”‚  â”‚  â””â”€ Preview en tiempo real\nâ”‚  â””â”€ Guardar / Exportar JSON\nâ”‚\nâ”œâ”€ Tab CARTAS\nâ”‚  â”œâ”€ Lista (filtrar por tipo, facciÃ³n, rareza)\nâ”‚  â”œâ”€ Editor Visual\nâ”‚  â”‚  â”œâ”€ Stats bÃ¡sicos\nâ”‚  â”‚  â”œâ”€ Sinergias\nâ”‚  â”‚  â”œâ”€ Afinidades\nâ”‚  â”‚  â”œâ”€ Efectos de combate\nâ”‚  â”‚  â””â”€ Imagen\nâ”‚  â””â”€ Guardar\nâ”‚\nâ”œâ”€ Tab NAVES\nâ”‚  â”œâ”€ Editor de estadÃ­sticas especiales\nâ”‚  â”œâ”€ Habilidades especiales\nâ”‚  â””â”€ Guardar\nâ”‚\nâ”œâ”€ Tab TIENDAS\nâ”‚  â”œâ”€ ConfiguraciÃ³n de traits\nâ”‚  â”œâ”€ Inventario (drag & drop)\nâ”‚  â”œâ”€ Servicios disponibles\nâ”‚  â”œâ”€ DiÃ¡logo de bienvenida\nâ”‚  â””â”€ Guardar\nâ”‚\nâ”œâ”€ Tab DIÃLOGOS\nâ”‚  â”œâ”€ Secuencias de diÃ¡logo entre personajes\nâ”‚  â”œâ”€ Mensajes visuales\nâ”‚  â”œâ”€ Editor con timeline\nâ”‚  â””â”€ Guardar\nâ”‚\nâ””â”€ Tab CADENAS\n   â”œâ”€ Vista de grafo visual (nodos y conexiones)\n   â”œâ”€ Editor de nodos\n   â”‚  â”œâ”€ Evento asociado\n   â”‚  â”œâ”€ Condiciones\n   â”‚  â””â”€ Transiciones\n   â”œâ”€ Simulador de caminos\n   â””â”€ Guardar\n```\n\n### **2. ALMACENAMIENTO (JSON)**\n\n```json\n{\n  \"version\": \"1.0.0\",\n  \"metadata\": {...},\n  \n  \"cards\": [...],           // Todas las cartas\n  \"ships\": [...],           // Naves disponibles\n  \"shops\": [...],           // Tiendas y vendedores\n  \n  \"encounters\": [...],      // Eventos de encuentro\n  \"hazards\": [...],         // Eventos de peligro\n  \"eventChains\": [...],     // Cadenas narrativas\n  \n  \"dialogues\": [...],       // DiÃ¡logos entre personajes\n  \"messages\": [...],        // Mensajes del sistema\n  \n  \"synergies\": [...],       // Sinergias de cartas\n  \"achievements\": [...],    // Logros\n  \n  \"flags\": {...},           // Definiciones de banderas\n  \"combatEffects\": {...}    // Definiciones de efectos\n}\n```\n\n### **3. CARGA (ContentEngine)**\n\n```\nAp inicia\n  â”‚\n  â””â”€ await contentEngine.load('content/content.json')\n     â”‚\n     â”œâ”€ Fetch del JSON\n     â”œâ”€ Validar contra schema\n     â”œâ”€ Parse y cachear\n     â””â”€ Iniciar managers\n        â”œâ”€ EventManager (eventos simples)\n        â”œâ”€ EventChainManager (cadenas)\n        â”œâ”€ ShopManager (tiendas)\n        â””â”€ DialogueManager (diÃ¡logos)\n  â”‚\n  â””â”€ Listo para usar\n```\n\n### **4. EJECUCIÃ“N (En Juego)**\n\n```\nJugador llega a nodo ENCOUNTER\n  â”‚\n  â”œâ”€ Â¿Hay cadena activa?\n  â”‚  â””â”€ SÃ­ â†’ EventChainManager.getCurrentEvent()\n  â”‚\n  â”œâ”€ Â¿Puede iniciarse nueva cadena?\n  â”‚  â””â”€ SÃ­ â†’ EventChainManager.startChain()\n  â”‚\n  â””â”€ Evento aleatorio normal\n     â””â”€ EventManager.getRandomEncounter()\n  â”‚\n  â””â”€ Mostrar EventCard con:\n     â”œâ”€ Narrativa\n     â”œâ”€ Imagen/Video\n     â”œâ”€ Opciones\n     â””â”€ Preview de consecuencias\n  â”‚\n  â””â”€ Jugador selecciona opciÃ³n\n     â”‚\n     â”œâ”€ ProcessConsequence()\n     â”‚  â”œâ”€ Calcular resultado (probabilidad)\n     â”‚  â”œâ”€ Aplicar cambios de estado\n     â”‚  â”œâ”€ Activar banderas\n     â”‚  â”œâ”€ Cambiar afinidad\n     â”‚  â””â”€ Mostrar diÃ¡logos\n     â”‚\n     â””â”€ Â¿Es parte de cadena?\n        â””â”€ EventChainManager.processChainChoice()\n           â”œâ”€ Verificar condiciones siguientes\n           â”œâ”€ Avanzar nodo\n           â””â”€ Marcar prÃ³ximo evento\n```\n\n---\n\n## ğŸ® Tipos de Contenido Soportados\n\n### **1. Eventos Simples**\n- Encuentro de exploraciÃ³n\n- Peligro galÃ¡ctico\n- Evento de combate\n- Evento de negociaciÃ³n\n\n### **2. Cadenas Narrativas**\n- \"La Base Abandonada\" (exploraciÃ³n â†’ combate)\n- \"El Misterio de Vex\" (narrativo de 4 capÃ­tulos)\n- \"MotÃ­n a Bordo\" (interno con condiciones)\n- Cualquier combinaciÃ³n de eventos interconectados\n\n### **3. Cartas de Juego**\n- Cartas de TripulaciÃ³n (con afinidades)\n- Cartas de Ataque\n- Cartas de Habilidad\n- Cartas de Equipo\n- Cartas de Nave (especiales)\n\n### **4. Tiendas**\n- Diferentes traits (Generoso, Avaro, etc)\n- Inventarios Ãºnicos\n- Servicios especÃ­ficos\n- DiÃ¡logos personalizados\n\n### **5. DiÃ¡logos**\n- Entre tripulantes\n- Con NPCs\n- CinemÃ¡ticas\n- Con mÃºsica y efectos visuales\n\n### **6. Sinergias**\n- Por facciÃ³n\n- Multi-cartas\n- Con efectos visuales\n- Activables/desactivables\n\n---\n\n## ğŸ”§ CaracterÃ­sticas del Motor\n\n### **ContentEngine**\n```typescript\nclass ContentEngine {\n  load(path: string)                    // Cargar JSON\n  validate(schema: any)                 // Validar estructura\n  getEvent(type, chainId?)              // Obtener evento\n  getCard(id)                           // Obtener carta\n  getShop(id)                           // Obtener tienda\n  getDialogue(id)                       // Obtener diÃ¡logo\n  getSynergies(cards)                   // Calcular sinergias\n  applyConsequence(option, state)       // Aplicar consecuencia\n}\n```\n\n### **EventChainManager**\n```typescript\nclass EventChainManager {\n  startChain(chainId, state)            // Iniciar cadena\n  processChainChoice(chainId, nodeId)   // Avanzar en cadena\n  completeChain(chainId, state)         // Completar cadena\n  abandonChain(chainId, state)          // Abandonar cadena\n  checkForTriggered(state)              // Ver si hay cadenas activables\n}\n```\n\n---\n\n## ğŸ“Š Sistema de ValidaciÃ³n\n\n```\nEditor JS â†’ Validar Localmente\n           â”œâ”€ IDs Ãºnicos\n           â”œâ”€ Referencias vÃ¡lidas\n           â”œâ”€ Campos requeridos\n           â””â”€ Tipos correctos\n           â”‚\n           â””â”€ OK â†’ Guardar JSON\n              â”‚\n              â””â”€ Motor en Juego â†’ Validar al cargar\n                 â”œâ”€ Esquema completo\n                 â”œâ”€ Referencias circulares\n                 â””â”€ Integridad\n```\n\n---\n\n## ğŸ¯ Ventajas de Esta Arquitectura\n\nâœ… **SeparaciÃ³n Total:** Contenido â‰  CÃ³digo  \nâœ… **Editabilidad:** Cambiar contenido sin compilar  \nâœ… **Modularidad:** Cada tipo de contenido es independiente  \nâœ… **Escalabilidad:** Agregar 1000 eventos es trivial  \nâœ… **Colaborativo:** MÃºltiples personas pueden editar JSON  \nâœ… **Versionable:** Git controla todo el contenido  \nâœ… **Testeable:** Validar JSON antes de usar  \nâœ… **Extensible:** Nuevos tipos de contenido fÃ¡cilmente  \nâœ… **Portable:** JSON funciona en cualquier lado  \nâœ… **Performante:** CachÃ© y lazy-loading de contenido  \n\n---\n\n## ğŸš€ Roadmap de ImplementaciÃ³n\n\n### **Sprint 1: Esquema (1-2 dÃ­as)**\n- âœ… types/content-schema.ts\n- âœ… types/event-chains.ts\n- âœ… DocumentaciÃ³n\n\n### **Sprint 2: Editor Base (3-4 dÃ­as)**\n- [ ] HTML/CSS bÃ¡sico\n- [ ] CRUD para eventos\n- [ ] Preview en tiempo real\n- [ ] Export/Import JSON\n\n### **Sprint 3: ExpansiÃ³n Editor (2-3 dÃ­as)**\n- [ ] CRUD para cartas\n- [ ] CRUD para tiendas\n- [ ] CRUD para diÃ¡logos\n- [ ] Editor de cadenas (visual)\n\n### **Sprint 4: Motor (2-3 dÃ­as)**\n- [ ] ContentEngine\n- [ ] EventChainManager\n- [ ] Validador de esquemas\n- [ ] Cache y optimizaciÃ³n\n\n### **Sprint 5: IntegraciÃ³n (2-3 dÃ­as)**\n- [ ] Reemplazar constants.ts\n- [ ] Actualizar componentes React\n- [ ] Testing\n- [ ] OptimizaciÃ³n de carga\n\n---\n\n## ğŸ“ PrÃ³ximos Pasos\n\n1. **Empezar con Editor de Eventos**\n   - Prototipo simple con HTML/JS\n   - CRUD funcional\n   - Export a JSON\n\n2. **Crear ejemplos JSON**\n   - 3-4 eventos de ejemplo\n   - 5-10 cartas de ejemplo\n   - 1-2 tiendas de ejemplo\n   - 1 cadena narrativa completa\n\n3. **Implementar ContentEngine**\n   - Cargar JSON\n   - ValidaciÃ³n bÃ¡sica\n   - APIs de acceso\n\n4. **Integrar en juego**\n   - Reemplazar hardcoded data\n   - Probar con juego en vivo\n   - Optimizar rendimiento\n\n---\n\n## ğŸ”— Referencias\n\n- [Content System Plan](CONTENT_SYSTEM_PLAN.md)\n- [Event Chains Design](EVENT_CHAINS_DESIGN.md)\n- [Types: content-schema.ts](types/content-schema.ts)\n- [Types: event-chains.ts](types/event-chains.ts)\n\n---\n\n**Esta arquitectura permite crear un juego completamente editable sin tocar cÃ³digo.**\n"}